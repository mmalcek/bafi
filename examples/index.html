<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://mmalcek.github.io/bafi/examples/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Examples - BaFi</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/lua.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/powershell.min.js"></script>
        <script>hljs.highlightAll();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-GE1PDVJERL"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', "G-GE1PDVJERL");
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
            <div class="container">
                <a class="navbar-brand" href="..">BaFi</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Application</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Examples</a>
                            </li>
                            <li class="navitem">
                                <a href="../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../about/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#examples" class="nav-link">Examples</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#command-line" class="nav-link">Command line</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#basic" class="nav-link">Basic</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#inline-template" class="nav-link">Inline template</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#stdinrest" class="nav-link">Stdin/REST</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#append-output-file" class="nav-link">Append output file</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#template" class="nav-link">Template</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#xml-to-csv" class="nav-link">XML to CSV</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#json-to-csv" class="nav-link">JSON to CSV</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#json-to-html" class="nav-link">JSON to HTML</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#json-to-custom-xml" class="nav-link">JSON to custom XML</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#xml-to-custom-json" class="nav-link">XML to custom JSON</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#csv-to-text" class="nav-link">CSV to text</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#mt940-to-csv" class="nav-link">mt940 to CSV</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#any-sql-to-xml" class="nav-link">Any SQL to XML</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#mongodump-to-csv" class="nav-link">MongoDump to CSV</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#dashes-in-key-names" class="nav-link">Dashes in key names</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#input-autoformat-to-xxx" class="nav-link">Input autoformat to XXX</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#chatgpt-query" class="nav-link">ChatGPT query</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#multiple-input-files" class="nav-link">Multiple input files</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="examples">Examples</h1>
<h2 id="command-line">Command line</h2>
<p>note: in Powershell you must use <span style="color:red; font-weight: bold;">.\</span>bafi.exe e.g.</p>
<pre><code class="language-powershell">.\bafi.exe -i input.csv -t &quot;?{{toXML .}}&quot;
curl.exe -s someurl.com/api/xxx | .\bafi.exe -f json -t &quot;?{{toXML .}}&quot;
</code></pre>
<h3 id="basic">Basic</h3>
<p>Get data from <em>testdata.xml</em> -&gt; process using <em>template.tmpl</em> -&gt; save output as <em>output.txt</em></p>
<pre><code class="language-sh">bafi.exe -i testdata.xml -t template.tmpl -o output.txt
</code></pre>
<h3 id="inline-template">Inline template</h3>
<p>Get data from <em>testdata.xml</em> -&gt; process using inline template -&gt; save output as <em>output.json</em></p>
<pre><code class="language-sh">bafi.exe -i testdata.xml -o output.json -t &quot;?{{toJSON .}}&quot;
</code></pre>
<p>note: BaFi inline template must start with <strong>?</strong> e.g. <strong>"?{{toJSON .}}"</strong>
<a href="https://pkg.go.dev/text/template#hdr-Examples">How to format inline templates</a></p>
<h3 id="stdinrest">Stdin/REST</h3>
<p>Get data from REST api -&gt; convert to XML -&gt; output to Stdout.</p>
<pre><code class="language-sh">curl.exe -s https://api.predic8.de/shop/customers/ | bafi.exe -f json -t &quot;?{{toXML .}}&quot;
</code></pre>
<p>More info about curl <a href="https://curl.se/">here</a> but you can of course use any tool with stdout</p>
<h3 id="append-output-file">Append output file</h3>
<p>Redirect stdout to file and append ( &gt; = replace, &gt;&gt; = apppend )</p>
<pre><code class="language-sh">bafi.exe -i testdata.xml -t template.tmpl &gt;&gt; output.txt
</code></pre>
<h2 id="template">Template</h2>
<p>Examples are based on testdata.tmpl included in project</p>
<h3 id="xml-to-csv">XML to CSV</h3>
<ul>
<li>command</li>
</ul>
<pre><code class="language-sh">bafi.exe -i testdata.xml -t myTemplate.tmpl -o output.csv
</code></pre>
<ul>
<li>myTemplate.tmpl</li>
</ul>
<pre><code>Employee,Date,val1,val2,val3,SUM,LuaMultiply,linkedText
{{- range .TOP_LEVEL.DATA_LINE}}
{{index .Employee &quot;-ID&quot;}},
{{- dateFormat .Trans_Date &quot;2006-01-02&quot; &quot;02.01.2006&quot;}},
{{- .val1}},{{.val2}},{{.val3}},
{{- add .val1 .val2}},
{{- lua &quot;mul&quot; .val1 .val2}},&quot;{{index .Linked_Text &quot;-VALUE&quot;}}&quot;
{{- end}}
</code></pre>
<h3 id="json-to-csv">JSON to CSV</h3>
<ul>
<li>command</li>
</ul>
<pre><code class="language-sh">curl.exe -s https://api.predic8.de/shop/customers/ | bafi.exe -f json -t myTemplate.tmpl -o output.html
</code></pre>
<ul>
<li>myTemplate.tmpl</li>
</ul>
<pre><code>name,surname
{{- range .customers}}
&quot;{{.firstname}}&quot;,&quot;{{.lastname}}&quot;
{{- end}}
</code></pre>
<h3 id="json-to-html">JSON to HTML</h3>
<ul>
<li>command</li>
</ul>
<pre><code class="language-sh">curl.exe -s https://api.predic8.de/shop/customers/ | bafi.exe -f json -t myTemplate.tmpl -o output.html
</code></pre>
<ul>
<li>myTemplate.tmpl</li>
</ul>
<pre><code>&lt;html&gt;
    &lt;body&gt;
        &lt;table&gt;
            &lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Surname&lt;/th&gt;&lt;/tr&gt;
            {{- range .customers}}
            &lt;tr&gt;&lt;td&gt;{{.firstname}}&lt;/td&gt;&lt;td&gt;{{.lastname}}&lt;/td&gt;&lt;/tr&gt;
            {{- end }}
        &lt;/table&gt;
    &lt;/body&gt;
&lt;/html&gt;

&lt;style&gt;
table, th, td { border: 1px solid black; width: 400px; }
&lt;/style&gt;
</code></pre>
<h3 id="json-to-custom-xml">JSON to custom XML</h3>
<ul>
<li>command</li>
</ul>
<pre><code class="language-sh">curl.exe -s https://api.predic8.de/shop/customers/ | bafi.exe -f json -t myTemplate.tmpl -o output.xml
</code></pre>
<ul>
<li>myTemplate.tmpl</li>
</ul>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;MY_DATA&gt;
    {{- range .customers}}
    &lt;CUSTOMMER&gt;
        &lt;NAME&gt;{{.firstname}}&lt;/NAME&gt;
        &lt;SURNAME&gt;{{.lastname}}&lt;/SURNAME&gt;
    &lt;/CUSTOMMER&gt;
    {{- end }}
&lt;/MY_DATA&gt;
</code></pre>
<h3 id="xml-to-custom-json">XML to custom JSON</h3>
<ul>
<li>command</li>
</ul>
<pre><code class="language-sh">bafi.exe -i testdata.xml -t myTemplate.tmpl -o output.json
</code></pre>
<ul>
<li>myTemplate.tmpl</li>
</ul>
<pre><code>{{- $new := &quot;{\&quot;employees\&quot;: [&quot; }}
{{- range .TOP_LEVEL.DATA_LINE}}
{{- $new = print $new &quot;{\&quot;employeeID\&quot;:\&quot;&quot; (index .Employee &quot;-ID&quot;) &quot;\&quot;, \&quot;val1\&quot;:&quot; .val1 &quot;},&quot; }}
{{- end}}
{{- /* Trim trailing comma, alternatively you can remove last char by &quot;(slice $new 0 (sub (len $new) 1))&quot; */}}
{{- $new = print (trimSuffix $new &quot;,&quot; ) &quot;]}&quot;}}
{{ $new}}
</code></pre>
<p>JSON in $new variable can be mapped to struct and autoformatted to other formats like:</p>
<ul>
<li>Transform $new to YAML</li>
</ul>
<pre><code>{{toYAML (mapJSON $new) -}}
</code></pre>
<ul>
<li>Transform $new to XML</li>
</ul>
<pre><code>{{toXML (mapJSON $new) -}}
</code></pre>
<h3 id="csv-to-text">CSV to text</h3>
<ul>
<li>command</li>
</ul>
<pre><code class="language-sh">bafi.exe -i users.csv -t myTemplate.tmpl -o output.txt
</code></pre>
<p>users.csv</p>
<pre><code>name,surname
John,&quot;Jack Doe&quot;
</code></pre>
<ul>
<li>myTemplate.tmpl</li>
</ul>
<pre><code>Users:
{{- range .}}
Name: {{.name}}, Surname: {{.surname}}
{{- end}}
</code></pre>
<p>note: CSV file must be <strong><a href="https://datatracker.ietf.org/doc/html/rfc4180">RFC4180</a></strong> compliant, file must have header line and separator must be <strong>comma ( , )</strong>. Or you can use command line argument -d ( e.g. <strong>-d ';'</strong> or <strong>-d 0x09</strong> ) to define separator(delimiter).</p>
<h3 id="mt940-to-csv">mt940 to CSV</h3>
<ul>
<li>mt940 returns simple struct (Header,Fields,[]Transactions) of strings and additional parsing needs to be done in template. This allows full flexibility on data processing</li>
<li>Identifiers are prefixed by <strong>"F_"</strong> (e.g. <strong>:20:</strong> = <strong>.Fields.F_20</strong>)</li>
<li>if parameter -d (delimiter e.g. -d "-}\r\n" or "\r\n$") is defined for files with multiple messages (e.g. - Multicash), app returns array of mt940 messages.</li>
<li>
<p>Note: This is actually good place to use integrated <a href="/bafi/#lua-custom-functions">LUA interpreter</a> where you can create your own set of custom functions to parse data and easily reuse them in templates.</p>
</li>
<li>
<p>command</p>
</li>
</ul>
<pre><code class="language-sh">bafi.exe -i message.sta -t myTemplate.tmpl -o output.csv
</code></pre>
<ul>
<li>myTemplate.tmpl</li>
</ul>
<pre><code>Reference, balance, VS
{{- $F20 := .Fields.F_20 }}{{ $F60F := .Fields.F_60F }}
{{range .Transactions }}
{{- $vsS := add (indexOf .F_86 &quot;?21&quot;) 3 }} {{- $vsE := add $vsS 17 -}}
{{- $F20}}, {{$F60F}}, {{slice .F_86 $vsS $vsE}}
{{ end }}
</code></pre>
<h3 id="any-sql-to-xml">Any SQL to XML</h3>
<p>Bafi can be used in combination with very interesting tool <strong>USQL</strong> <a href="https://github.com/xo/usql">https://github.com/xo/usql</a>. USQL allows query almost any SQL like database (MSSQL,MySQL,postgres, ...) and get result in various formats. In this example we use -J for JSON. Output can be further processed by BaFi and templates</p>
<pre><code class="language-sh">usql.exe mssql://user:password@server/instance/database -c &quot;SELECT * FROM USERS&quot; -J -q | bafi.exe -f json -t &quot;?{{toXML .}}&quot;
</code></pre>
<h3 id="mongodump-to-csv">MongoDump to CSV</h3>
<ul>
<li>command</li>
</ul>
<pre><code class="language-sh">bafi.exe -i users.bson -t myTemplate.tmpl -o output.html
</code></pre>
<ul>
<li>myTemplate.tmpl</li>
</ul>
<pre><code>name,surname
{{- range .}}
&quot;{{.firstname}}&quot;,&quot;{{.lastname}}&quot;
{{- end}}
</code></pre>
<h3 id="dashes-in-key-names">Dashes in key names</h3>
<p>If key name contains dashes ( - ) bafi will fail with error "bad character U+002D '-'" for example:</p>
<pre><code>{{.my-key.subkey}}
</code></pre>
<p>This is known limitation of go templates which can be solved by workaround</p>
<pre><code>{{index . &quot;my-key&quot; &quot;subkey&quot;}}
</code></pre>
<h3 id="input-autoformat-to-xxx">Input autoformat to XXX</h3>
<p>Input data can be easily fomated to oher formats by functions <strong>toXML,toJSON,toBSON,toYAML</strong>. In this case its not necesarry add template file because it's as easy as</p>
<pre><code class="language-sh">curl.exe -s https://api.predic8.de/shop/customers/ | bafi.exe -f json -t &quot;?{{toXML .}}&quot; -o output.xml
curl.exe -s https://api.predic8.de/shop/customers/ | bafi.exe -f json -t &quot;?{{toJSON .}}&quot; -o output.json
curl.exe -s https://api.predic8.de/shop/customers/ | bafi.exe -f json -t &quot;?{{toBSON .}}&quot; -o output.bson
curl.exe -s https://api.predic8.de/shop/customers/ | bafi.exe -f json -t &quot;?{{toYAML .}}&quot; -o output.yml
</code></pre>
<h3 id="chatgpt-query">ChatGPT query</h3>
<pre><code class="language-sh">curl -s https://www.ecb.europa.eu/stats/eurofxref/eurofxref-daily.xml | ./bafi -f xml -gk myChatGPTToken -gq &quot;What's the current CZK rate?&quot;
curl -s https://www.ecb.europa.eu/stats/eurofxref/eurofxref-daily.xml | ./bafi -f xml -gk myChatGPTToken -gq &quot;format rates to html&quot; -gm gpt4
./bafi -i invoice.json -gk myChatGPTToken -gq &quot;create XML UBL format invoice&quot; -o invoice.xml

</code></pre>
<h3 id="multiple-input-files">Multiple input files</h3>
<p>Bafi can read multiple input files and merge them into one output file. This will require aditional file with files description.
Description file must be in YAML format as described below and prefixed by question mark <strong>"?"</strong> for examle <strong>bafi.exe -i ?files.yaml</strong></p>
<p>Example:</p>
<ul>
<li>batch file which gets the data from multiple sources <strong>myFiles.bat</strong></li>
</ul>
<pre><code class="language-sh">curl -s https://www.ecb.europa.eu/stats/eurofxref/eurofxref-daily.xml &gt; ecbRates.xml
curl -s https://goweather.herokuapp.com/weather/prague &gt; pragueWeather.json
</code></pre>
<ul>
<li>Files description <strong>myFiles.yaml</strong></li>
</ul>
<pre><code class="language-yaml">- file: ./ecbRates.xml # file path
  format: xml # File format
  label: RATES # Label which will be used in the template {{ .RATES }}
- file: ./pragueWeather.json
  format: json
  label: WEATHER
</code></pre>
<ul>
<li>Template file <strong>myTemplate.tmpl</strong> which will generate simple HTML page with data</li>
</ul>
<pre><code class="language-html">&lt;html&gt;
    &lt;body&gt;
    &lt;h3&gt; Weather in Prague &lt;/h3&gt;
    &lt;h4&gt; Temperatre: {{.WEATHER.temperature}} &lt;/h4&gt;
    &lt;h4&gt; Wind: {{.WEATHER.wind}} &lt;/h4&gt;
    &lt;h3&gt; ECB Exchange rates from: {{dateFormat (index .RATES.Envelope.Cube.Cube &quot;-time&quot;) &quot;2006-01-02&quot; &quot;02.01.2006&quot; }}&lt;/h3&gt;
        &lt;table&gt;
            &lt;tr&gt;&lt;th&gt;currency&lt;/th&gt;&lt;th&gt;rate&lt;/th&gt;
            {{- range .RATES.Envelope.Cube.Cube.Cube }}
            &lt;tr&gt;&lt;td&gt;{{index . &quot;-currency&quot; }}&lt;/td&gt;&lt;td&gt;{{index . &quot;-rate&quot; }}&lt;/td&gt;
            {{- end}}
        &lt;/table&gt;
    &lt;body&gt;
&lt;/html&gt;

&lt;style&gt;
table, th, td { border: 1px solid black; width: 400px; }
&lt;/style&gt;
</code></pre>
<ul>
<li>Finally run bafi</li>
</ul>
<pre><code class="language-sh">bafi.exe -t myTemplate.tmpl -i ?myFiles.yaml -o output.html
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
